<%# Default modal dialog for editing a (collectible, taggable) item. May be overwritten for other controllers  %>
<% decorator ||= @decorator || TemplateDecorator.new # If no decorator provided, assume this is for a template        %>
<%= modal_dialog "lists-collectible new-style green", decorator.title.truncate(70), dialog_class: 'dialog-sm' do %>
    <form accept-charset="UTF-8"
          action="<%= decorator.lists_path %>"
          class="form-inline lists-collectible"
          data-remote="true"
          data-type="json"
          <%= "data-always_submit='true'" if decorator.picuri_problem %>
          id="lists_collectible_<%= decorator.id %>">
      <input name="utf8" type="hidden" value="&#x2713;"/>
      <input name="_method" type="hidden" value="patch"/>
      <input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>"/>
      <% user_decorator = current_user_or_guest.decorate %>
      <% all_tags = user_decorator.list_tags %>
      <% classify_listtags all_tags %>
      <% used_tags = user_decorator.list_tags(decorator) %>
      <% classify_listtags used_tags %>
      <div class="row">
        <div class="col-md-12">
          <div class="notifications-panel">
            <%= flash_notifications_div %>
          </div>
          <div class="control-group now-appearing">
            <label class="string optional">Now Appearing on the Lists:</label>
            <input id="<%= decorator.element_id :tagging_user_id %>"
                   name="<%= decorator.field_name :tagging_user_id %>"
                   type="hidden"
                   value="<%= decorator.tagging_user_id %>">
            <input type="text"
                   class="token-input-field-pending"
                   id="tagging_lists_tokens"
                   name="<%= decorator.field_name :tagging_lists_tokens %>"
                   rows="2"
                   size="30"
                   placeholder="Lists"
                   data-taglist="<%= all_tags.to_json %>"
                   data-pre="<%= used_tags.to_json %>"
                   data-free_tagging="false"
                   data-event_handler="RP.lists_collectible"
                   data-theme="list"
                   data-query="tagtype=16"
                   data-hint_text="Search for a list by typing"/>
          </div>
          <div class="control-group">
            <label class="string optional" style="margin-top: 40px;">Suggested Lists</label>
            <div class="selection-list" data->
              <% all_tags.each do |tagspec| %>
                  <!--Include only the lists of friends and self -->
                  <% if tagspec[:status] %>
                      <a href="#"
                         class="selection-item <%= tagspec[:cssclass] %>"
                         id="<%= tagspec[:cssid] %>"
                         data-to_selector="#tagging_lists_tokens"
                         data-tokeninput="<%= tagspec.to_json %>"
                         <%= %q{style="display: none;"} if used_tags.include? tagspec %>
                         title="Click to Add">
                        <%= tagspec[:name] %>
                      </a>
                  <% end %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
      <%= dialog_submit_button %>
      <%= dialog_cancel_button %>
    </form>
<% end %>

